/**
 * Exploit keyword ability (Rule 702.110)
 * 
 * From the MTG Comprehensive Rules (Nov 2025):
 * 
 * 702.110. Exploit
 * 702.110a Exploit is a triggered ability. "Exploit" means "When this permanent enters, 
 * you may sacrifice a creature."
 * 702.110b A creature with exploit "exploits a creature" when the controller of the exploit 
 * ability sacrifices a creature as that ability resolves.
 * 702.110c If a permanent has multiple instances of exploit, each triggers separately.
 */

export interface ExploitAbility {
  readonly type: 'exploit';
  readonly source: string;
  readonly exploitedCreature?: string;
  readonly sacrificedCreature?: string;
  readonly didExploit: boolean;
  readonly exploited: boolean;
}

/**
 * Create an exploit ability
 * Rule 702.110a
 */
export function exploit(source: string): ExploitAbility {
  return {
    type: 'exploit',
    source,
    didExploit: false,
    exploited: false,
  };
}

/**
 * Sacrifice a creature for exploit ability
 * Rule 702.110b
 */
export function doExploit(
  ability: ExploitAbility,
  sacrificedCreature: string
): ExploitAbility {
  return {
    ...ability,
    exploitedCreature: sacrificedCreature,
    sacrificedCreature,
    didExploit: true,
    exploited: true,
  };
}

/**
 * Complete exploit by sacrificing a creature
 * Alias for doExploit to match test expectations
 * Rule 702.110b
 */
export function completeExploit(
  ability: ExploitAbility,
  sacrificedCreature: string
): ExploitAbility {
  return doExploit(ability, sacrificedCreature);
}

/**
 * Decline to exploit (don't sacrifice a creature)
 */
export function declineExploit(ability: ExploitAbility): ExploitAbility {
  if (ability.didExploit) {
    return ability;
  }
  
  return {
    ...ability,
    didExploit: false,
  };
}

/**
 * Check if a creature was exploited
 * Rule 702.110b
 */
export function didExploitCreature(ability: ExploitAbility): boolean {
  return ability.didExploit;
}

/**
 * Get the exploited creature
 */
export function getExploitedCreature(ability: ExploitAbility): string | undefined {
  return ability.exploitedCreature;
}

/**
 * Multiple instances of exploit trigger separately
 * Rule 702.110c
 */
export function hasRedundantExploit(
  abilities: readonly ExploitAbility[]
): boolean {
  return false; // Each instance triggers separately
}
